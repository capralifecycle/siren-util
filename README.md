# siren-util

[![CircleCI](https://circleci.com/gh/capraconsulting/siren-util.svg?style=svg)](https://circleci.com/gh/capraconsulting/siren-util)
[![Central Repository](https://img.shields.io/maven-central/v/no.capraconsulting/siren-util?label=release)](https://search.maven.org/search?q=g:no.capraconsulting%20AND%20a:siren-util)
[![Quality Gate Status](https://sonarcloud.io/api/project_badges/measure?project=capraconsulting_siren-util&metric=alert_status)](https://sonarcloud.io/dashboard?id=capraconsulting_siren-util)
[![Coverage](https://sonarcloud.io/api/project_badges/measure?project=capraconsulting_siren-util&metric=coverage)](https://sonarcloud.io/dashboard?id=capraconsulting_siren-util)
[![Technical Debt](https://sonarcloud.io/api/project_badges/measure?project=capraconsulting_siren-util&metric=sqale_index)](https://sonarcloud.io/dashboard?id=capraconsulting_siren-util)

Build and parse [Siren hypermedia](https://github.com/kevinswiber/siren)
compliant JSON representations of entities.

## Example

```java
Map<String, Object> properties = new LinkedHashMap<>();
properties.put("orderNumber", 42);
properties.put("itemCount", 3);
properties.put("status", "pending");

// Building.
Root siren = Root
    .newBuilder()
    .clazz("order")
    .properties(properties)
    .links(
        Link.newBuilder("self", URI.create("https://example.com/orders/42")).build()
    )
    .build();

String json = siren.toJson();
// Result: {"class":["order"],"properties":{"orderNumber":42,"itemCount":3,"status":"pending"},"links":[{"rel":["self"],"href":"https://example.com/orders/42"}]}

// Parsing.
Root parsed = Root.fromJson(json);
if (parsed.getProperties() != null) {
    parsed.getProperties().get("status");
    // Result: pending
}

// Updating.
Map<String, Object> newProperties = new LinkedHashMap<>(parsed.getProperties());
newProperties.put("status", "completed");
Root updated = parsed.toBuilder()
    .properties(newProperties)
    .build();
```

See tests for more examples.

## Contributing

### Snapshot tests

Files in `src/test/resources` that ends with `.snapshot` are generated by
the tests and updated automatically by setting `REGENERATE_SNAPSHOTS=true`
system property.

Example:

```bash
mvn test -DREGENERATE_SNAPSHOTS=true
```

When a snapshot fails the easiest way to compare the changes are by regenering
snapshots and using Git diff.

### Performing releases

Currently done from the developer machine having write access to
GitHub and OSSRH. See https://confluence.capraconsulting.no/x/mTBaBw
for internal details.

```bash
mvn release:prepare release:perform
```

#### Troubleshooting

* `gpg: signing failed: Inappropriate ioctl for device`
  * `export GPG_TTY=$(tty)`
* `Unable to make field private final java.util.Comparator java.util.TreeMap.comparator accessible: module java.base does not “opens java.util” to unnamed module @4a9486c0`
  * `export JAVA_HOME=$(/usr/libexec/java_home -v1.8)`
